module.exports=[19507,a=>{"use strict";var b=a.i(69426),c=a.i(35843),d=a.i(60721),e=a.i(91119),f=a.i(6015),g=a.i(86304),h=a.i(99570),i=a.i(66718),j=a.i(80701);function k(){let[a,k]=(0,c.useState)("events"),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)([]),[p,q]=(0,c.useState)(0),[r,s]=(0,c.useState)(!0),[t,u]=(0,c.useState)("ALL"),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)("ALL"),[F,G]=(0,c.useState)("ALL"),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)(""),[L,M]=(0,c.useState)(!1),[N,O]=(0,c.useState)(null);(0,c.useEffect)(()=>{(0,d.apiClient)("/admin/events?types=true").then(a=>{a.success&&a.data&&o(a.data)}).catch(console.error)},[]);let P=(0,c.useCallback)(async()=>{s(!0);try{let a=new URLSearchParams({limit:"50"});t&&"ALL"!==t&&a.set("eventType",t);let b=await (0,d.apiClient)(`/admin/events?${a}`);b.success&&b.data&&(m(b.data.events),q(b.data.total))}catch(a){console.error("Failed to fetch events:",a)}finally{s(!1)}},[t]),Q=(0,c.useCallback)(async()=>{C(!0);try{let a=new URLSearchParams({limit:"50"});D&&"ALL"!==D&&a.set("status",D);let b=await (0,d.apiClient)(`/admin/outbox?${a}`);b.success&&b.data&&(y(b.data.items),A(b.data.stats))}catch(a){console.error("Failed to fetch outbox:",a)}finally{C(!1)}},[D]);(0,c.useEffect)(()=>{"events"===a?P():"outbox"===a&&Q()},[a,P,Q]);let R=async a=>{try{(await (0,d.apiClient)(`/admin/outbox/${a}/retry`,{method:"POST"})).success&&Q()}catch(a){console.error("Failed to retry:",a)}},S=async()=>{if(!H||!J)return void alert("Please select both from and to dates");M(!0),O(null);try{let a=await (0,d.apiClient)("/admin/events/replay",{method:"POST",body:JSON.stringify({eventType:"ALL"!==F?F:void 0,from:H,to:J})});a.success&&a.data&&O(a.data)}catch(a){console.error("Failed to replay:",a),O({message:"Replay failed. Check console for details."})}finally{M(!1)}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-slate-900",children:"Event Sourcing"}),(0,b.jsx)("p",{className:"text-slate-600",children:"Event log, outbox monitoring, and replay controls"})]})}),(0,b.jsx)("div",{className:"flex gap-1 p-1 bg-slate-100 rounded-lg w-fit",children:["events","outbox","replay"].map(c=>(0,b.jsxs)("button",{onClick:()=>k(c),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${a===c?"bg-white text-slate-900 shadow-sm":"text-slate-600 hover:text-slate-900"}`,children:[c.charAt(0).toUpperCase()+c.slice(1),"outbox"===c&&z&&z.pending>0&&(0,b.jsx)("span",{className:"ml-2 px-1.5 py-0.5 text-xs bg-amber-100 text-amber-700 rounded",children:z.pending})]},c))}),"events"===a&&(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(e.CardTitle,{children:"Event Log"}),(0,b.jsxs)(e.CardDescription,{children:[p," total events"]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(j.Select,{value:t,onValueChange:u,children:[(0,b.jsx)(j.SelectTrigger,{className:"w-48",children:(0,b.jsx)(j.SelectValue,{placeholder:"All event types"})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"ALL",children:"All event types"}),n.map(a=>(0,b.jsx)(j.SelectItem,{value:a,children:a},a))]})]}),(0,b.jsx)(h.Button,{variant:"outline",onClick:P,children:"Refresh"})]})]})}),(0,b.jsx)(e.CardContent,{children:r?(0,b.jsx)("div",{className:"text-center py-8 text-slate-500",children:"Loading events..."}):(0,b.jsxs)(f.Table,{children:[(0,b.jsx)(f.TableHeader,{children:(0,b.jsxs)(f.TableRow,{children:[(0,b.jsx)(f.TableHead,{className:"w-16",children:"ID"}),(0,b.jsx)(f.TableHead,{children:"Event Type"}),(0,b.jsx)(f.TableHead,{children:"Aggregate"}),(0,b.jsx)(f.TableHead,{children:"Timestamp"}),(0,b.jsx)(f.TableHead,{children:"Processed"}),(0,b.jsx)(f.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsxs)(f.TableBody,{children:[l.map(a=>(0,b.jsxs)(f.TableRow,{children:[(0,b.jsx)(f.TableCell,{className:"font-mono text-sm",children:a.id}),(0,b.jsx)(f.TableCell,{children:(0,b.jsx)(g.Badge,{variant:"outline",children:a.event_type})}),(0,b.jsxs)(f.TableCell,{children:[(0,b.jsx)("span",{className:"text-slate-500",children:a.aggregate_type}),(0,b.jsxs)("span",{className:"text-slate-400",children:[" #",a.aggregate_id]})]}),(0,b.jsx)(f.TableCell,{className:"text-sm",children:new Date(a.created_at).toLocaleString()}),(0,b.jsx)(f.TableCell,{children:a.processed_at?(0,b.jsx)(g.Badge,{variant:"default",children:"Yes"}):(0,b.jsx)(g.Badge,{variant:"secondary",children:"No"})}),(0,b.jsx)(f.TableCell,{className:"text-right",children:(0,b.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:()=>w(a),children:"View"})})]},a.id)),0===l.length&&(0,b.jsx)(f.TableRow,{children:(0,b.jsx)(f.TableCell,{colSpan:6,className:"text-center py-8 text-slate-500",children:"No events found"})})]})]})})]}),"outbox"===a&&(0,b.jsxs)(b.Fragment,{children:[z&&(0,b.jsx)("div",{className:"grid grid-cols-4 gap-4",children:[{label:"Pending",value:z.pending,color:"amber"},{label:"Processing",value:z.processing,color:"blue"},{label:"Delivered",value:z.delivered,color:"green"},{label:"Failed",value:z.failed,color:"red"}].map(a=>(0,b.jsx)(e.Card,{children:(0,b.jsxs)(e.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:`text-3xl font-bold text-${a.color}-600`,children:a.value}),(0,b.jsx)("div",{className:"text-sm text-slate-500",children:a.label})]})},a.label))}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(e.CardTitle,{children:"Outbox Queue"}),(0,b.jsx)(e.CardDescription,{children:"Reliable event delivery via outbox pattern"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(j.Select,{value:D,onValueChange:E,children:[(0,b.jsx)(j.SelectTrigger,{className:"w-36",children:(0,b.jsx)(j.SelectValue,{placeholder:"All statuses"})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"ALL",children:"All statuses"}),(0,b.jsx)(j.SelectItem,{value:"PENDING",children:"Pending"}),(0,b.jsx)(j.SelectItem,{value:"PROCESSING",children:"Processing"}),(0,b.jsx)(j.SelectItem,{value:"DELIVERED",children:"Delivered"}),(0,b.jsx)(j.SelectItem,{value:"FAILED",children:"Failed"})]})]}),(0,b.jsx)(h.Button,{variant:"outline",onClick:Q,children:"Refresh"})]})]})}),(0,b.jsx)(e.CardContent,{children:B?(0,b.jsx)("div",{className:"text-center py-8 text-slate-500",children:"Loading outbox..."}):(0,b.jsxs)(f.Table,{children:[(0,b.jsx)(f.TableHeader,{children:(0,b.jsxs)(f.TableRow,{children:[(0,b.jsx)(f.TableHead,{className:"w-16",children:"ID"}),(0,b.jsx)(f.TableHead,{children:"Event Type"}),(0,b.jsx)(f.TableHead,{children:"Status"}),(0,b.jsx)(f.TableHead,{children:"Retries"}),(0,b.jsx)(f.TableHead,{children:"Created"}),(0,b.jsx)(f.TableHead,{children:"Last Error"}),(0,b.jsx)(f.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsxs)(f.TableBody,{children:[x.map(a=>(0,b.jsxs)(f.TableRow,{children:[(0,b.jsx)(f.TableCell,{className:"font-mono text-sm",children:a.id}),(0,b.jsx)(f.TableCell,{children:(0,b.jsx)(g.Badge,{variant:"outline",children:a.event_type})}),(0,b.jsx)(f.TableCell,{children:(0,b.jsx)(g.Badge,{variant:(a=>{switch(a){case"DELIVERED":return"default";case"PENDING":return"secondary";case"PROCESSING":default:return"outline";case"FAILED":return"destructive"}})(a.status),children:a.status})}),(0,b.jsxs)(f.TableCell,{children:[a.retry_count,"/",a.max_retries]}),(0,b.jsx)(f.TableCell,{className:"text-sm",children:new Date(a.created_at).toLocaleString()}),(0,b.jsx)(f.TableCell,{className:"max-w-48 truncate text-sm text-red-600",children:a.last_error||"-"}),(0,b.jsx)(f.TableCell,{className:"text-right",children:"FAILED"===a.status&&(0,b.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>R(a.id),children:"Retry"})})]},a.id)),0===x.length&&(0,b.jsx)(f.TableRow,{children:(0,b.jsx)(f.TableCell,{colSpan:7,className:"text-center py-8 text-slate-500",children:"No outbox items found"})})]})]})})]})]}),"replay"===a&&(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"Event Replay"}),(0,b.jsx)(e.CardDescription,{children:"Re-process events within a date range. This will reset processed flags and re-add events to the outbox."})]}),(0,b.jsxs)(e.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Event Type (optional)"}),(0,b.jsxs)(j.Select,{value:F,onValueChange:G,children:[(0,b.jsx)(j.SelectTrigger,{children:(0,b.jsx)(j.SelectValue,{placeholder:"All event types"})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"ALL",children:"All event types"}),n.map(a=>(0,b.jsx)(j.SelectItem,{value:a,children:a},a))]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"From Date"}),(0,b.jsx)(i.Input,{type:"date",value:H,onChange:a=>I(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"To Date"}),(0,b.jsx)(i.Input,{type:"date",value:J,onChange:a=>K(a.target.value)})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(h.Button,{onClick:S,disabled:L||!H||!J,children:L?"Processing...":"Trigger Replay"}),N&&(0,b.jsx)("div",{className:`p-3 rounded-lg ${void 0!==N.eventsReplayed?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:N.message})]}),(0,b.jsxs)("div",{className:"mt-6 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[(0,b.jsx)("h4",{className:"font-medium text-amber-800",children:"⚠️ Important Notes"}),(0,b.jsxs)("ul",{className:"mt-2 text-sm text-amber-700 list-disc list-inside space-y-1",children:[(0,b.jsx)("li",{children:"Replay range is limited to 31 days maximum"}),(0,b.jsx)("li",{children:"Events will be re-added to the outbox for reprocessing"}),(0,b.jsx)("li",{children:"No ledger mutations occur during replay"}),(0,b.jsx)("li",{children:"Event handlers must be idempotent"})]})]})]})]}),v&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-auto",children:[(0,b.jsx)("div",{className:"p-6 border-b",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold",children:["Event #",v.id]}),(0,b.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:()=>w(null),children:"✕"})]})}),(0,b.jsxs)("div",{className:"p-6 space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-slate-500",children:"Event Type:"}),(0,b.jsx)("span",{className:"ml-2 font-medium",children:v.event_type})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-slate-500",children:"Aggregate:"}),(0,b.jsxs)("span",{className:"ml-2 font-medium",children:[v.aggregate_type," #",v.aggregate_id]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-slate-500",children:"Created:"}),(0,b.jsx)("span",{className:"ml-2",children:new Date(v.created_at).toLocaleString()})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-slate-500",children:"Processed:"}),(0,b.jsx)("span",{className:"ml-2",children:v.processed_at?new Date(v.processed_at).toLocaleString():"Not yet"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-sm text-slate-500 block mb-2",children:"Payload:"}),(0,b.jsx)("pre",{className:"bg-slate-50 p-4 rounded-lg text-sm overflow-x-auto",children:JSON.stringify(v.payload,null,2)})]})]})]})})]})}a.s(["default",()=>k])}];

//# sourceMappingURL=src_app_admin_events_page_tsx_22401688._.js.map