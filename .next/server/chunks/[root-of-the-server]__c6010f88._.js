module.exports=[49510,e=>{"use strict";var t=e.i(43793),a=e.i(90727);function r(e){return{id:e.id,customerNumber:e.customer_number,email:e.email,firstName:e.first_name,lastName:e.last_name,phone:e.phone,dateOfBirth:e.date_of_birth,nationalId:e.national_id,addressLine1:e.address_line1,addressLine2:e.address_line2,city:e.city,postalCode:e.postal_code,country:e.country,status:e.status,kycStatus:e.kyc_status,riskScore:e.risk_score,createdAt:e.created_at}}async function s(e){let a=await (0,t.queryOne)(`SELECT id, customer_number, email, first_name, last_name, phone,
            date_of_birth, national_id, address_line1, address_line2,
            city, postal_code, country, status, kyc_status, risk_score, created_at
     FROM customers
     WHERE id = ?`,[e]);return a?r(a):null}async function n(e){let a=await (0,t.queryOne)(`SELECT id, customer_number, email, first_name, last_name, phone,
            date_of_birth, national_id, address_line1, address_line2,
            city, postal_code, country, status, kyc_status, risk_score, created_at
     FROM customers
     WHERE email = ?`,[e]);return a?r(a):null}async function i(e){let{search:a,status:s,kycStatus:n,limit:i=50,offset:o=0}=e,u=["1=1"],c=[];if(a){u.push("(c.customer_number LIKE ? OR c.email LIKE ? OR c.first_name LIKE ? OR c.last_name LIKE ? OR c.national_id LIKE ?)");let e=`%${a}%`;c.push(e,e,e,e,e)}s&&(u.push("c.status = ?"),c.push(s)),n&&(u.push("c.kyc_status = ?"),c.push(n));let l=u.join(" AND "),d=await (0,t.queryOne)(`SELECT COUNT(*) as count FROM customers c WHERE ${l}`,c);return{customers:(await (0,t.query)(`SELECT c.id, c.customer_number, c.email, c.first_name, c.last_name, c.phone,
            c.date_of_birth, c.national_id, c.address_line1, c.address_line2,
            c.city, c.postal_code, c.country, c.status, c.kyc_status, c.risk_score, c.created_at,
            COUNT(a.id) as account_count,
            COALESCE(SUM(ab.available_balance), 0) as total_balance
     FROM customers c
     LEFT JOIN accounts a ON a.customer_id = c.id AND a.status = 'ACTIVE'
     LEFT JOIN account_balances ab ON ab.account_id = a.id
     WHERE ${l}
     GROUP BY c.id
     ORDER BY c.created_at DESC
     LIMIT ? OFFSET ?`,[...c,i,o])).map(e=>({...r(e),accountCount:e.account_count||0,totalBalance:parseFloat(e.total_balance||"0")})),total:d?.count||0}}async function o(e){if(await n(e.email))return{success:!1,error:"Email already exists"};let r=`C${Date.now().toString().slice(-10)}`,s=await (0,a.hashPassword)(e.password);try{let a=await (0,t.execute)(`INSERT INTO customers (
         customer_number, email, password_hash, first_name, last_name, phone,
         date_of_birth, national_id, address_line1, address_line2,
         city, postal_code, status, created_by
       ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 'PENDING', ?)`,[r,e.email,s,e.firstName,e.lastName,e.phone||null,e.dateOfBirth||null,e.nationalId||null,e.addressLine1||null,e.addressLine2||null,e.city||null,e.postalCode||null,e.createdBy]);return{success:!0,customerId:a.insertId,customerNumber:r}}catch(e){return console.error("Error creating customer:",e),{success:!1,error:"Failed to create customer"}}}async function u(e,a){let r=[],s=[];return(void 0!==a.firstName&&(r.push("first_name = ?"),s.push(a.firstName)),void 0!==a.lastName&&(r.push("last_name = ?"),s.push(a.lastName)),void 0!==a.phone&&(r.push("phone = ?"),s.push(a.phone)),void 0!==a.addressLine1&&(r.push("address_line1 = ?"),s.push(a.addressLine1)),void 0!==a.addressLine2&&(r.push("address_line2 = ?"),s.push(a.addressLine2)),void 0!==a.city&&(r.push("city = ?"),s.push(a.city)),void 0!==a.postalCode&&(r.push("postal_code = ?"),s.push(a.postalCode)),0===r.length)?{success:!1,error:"No fields to update"}:(r.push("updated_at = NOW()"),s.push(e),await (0,t.execute)(`UPDATE customers SET ${r.join(", ")} WHERE id = ?`,s),{success:!0})}e.s(["createCustomer",()=>o,"getCustomerById",()=>s,"searchCustomers",()=>i,"updateCustomer",()=>u])},32203,e=>{"use strict";var t=e.i(2961),a=e.i(99823),r=e.i(20478),s=e.i(30188),n=e.i(64717),i=e.i(22511),o=e.i(86406),u=e.i(82039),c=e.i(85794),l=e.i(97655),d=e.i(16847),p=e.i(5777),h=e.i(19298),m=e.i(73225),_=e.i(2380),E=e.i(93695);e.i(99970);var R=e.i(26738),f=e.i(74129),y=e.i(74726),v=e.i(49510);let C=(0,f.withErrorHandler)(async e=>(0,f.withAuth)(e,async t=>{let a=(0,f.validateQuery)(e,y.customerSearchSchema);if(!a.success)return a.response;let{search:r,status:s,kycStatus:n,page:i,limit:o}=a.data,u=(0,f.getOffset)(i,o),{customers:c,total:l}=await (0,v.searchCustomers)({search:r,status:s,kycStatus:n,limit:o,offset:u});return(0,f.successResponse)(c,(0,f.getPaginationMeta)(i,o,l))},{requiredType:"user",requiredPermissions:["customers.read"]})),w=(0,f.withErrorHandler)(async e=>(0,f.withAuth)(e,async t=>{let a=await (0,f.validateBody)(e,y.createCustomerSchema);if(!a.success)return a.response;let r=await (0,v.createCustomer)({...a.data,createdBy:t.user.id});return r.success?(0,f.createdResponse)({customerId:r.customerId,customerNumber:r.customerNumber}):(0,f.errorResponse)(r.error||"Failed to create customer")},{requiredType:"user",requiredPermissions:["customers.write"]}));e.s(["GET",0,C,"POST",0,w],54008);var N=e.i(54008);let O=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/v1/customers/route",pathname:"/api/v1/customers",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/v1/customers/route.ts",nextConfigOutput:"",userland:N}),{workAsyncStorage:b,workUnitAsyncStorage:g,serverHooks:T}=O;function A(){return(0,r.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:g})}async function S(e,t,r){O.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let f="/api/v1/customers/route";f=f.replace(/\/index$/,"")||"/";let y=await O.prepare(e,t,{srcPage:f,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:v,params:C,nextConfig:w,parsedUrl:N,isDraftMode:b,prerenderManifest:g,routerServerContext:T,isOnDemandRevalidate:A,revalidateOnlyGenerated:S,resolvedPathname:I,clientReferenceManifest:x,serverActionsManifest:P}=y,L=(0,o.normalizeAppPath)(f),k=!!(g.dynamicRoutes[L]||g.routes[I]),H=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,N,!1):t.end("This page could not be found"),null);if(k&&!b){let e=!!g.routes[I],t=g.dynamicRoutes[L];if(t&&!1===t.fallback&&!e){if(w.experimental.adapterPath)return await H();throw new E.NoFallbackError}}let q=null;!k||O.isDev||b||(q="/index"===(q=I)?"/":q);let U=!0===O.isDev||!k,D=k&&!U;P&&x&&(0,i.setManifestsSingleton)({page:f,clientReferenceManifest:x,serverActionsManifest:P});let F=e.method||"GET",M=(0,n.getTracer)(),B=M.getActiveScopeSpan(),$={params:C,prerenderManifest:g,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,s)=>O.onRequestError(e,t,r,s,T)},sharedContext:{buildId:v}},K=new u.NodeNextRequest(e),j=new u.NodeNextResponse(t),W=c.NextRequestAdapter.fromNodeNextRequest(K,(0,c.signalFromNodeResponse)(t));try{let i=async e=>O.handle(W,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=M.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${F} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${f}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),u=async s=>{var n,u;let c=async({previousCacheEntry:a})=>{try{if(!o&&A&&S&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(s);e.fetchMetrics=$.renderOpts.fetchMetrics;let u=$.renderOpts.pendingWaitUntil;u&&r.waitUntil&&(r.waitUntil(u),u=void 0);let c=$.renderOpts.collectedTags;if(!k)return await (0,p.sendResponse)(K,j,n,$.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(n.headers);c&&(t[_.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=_.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,r=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=_.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await O.onRequestError(e,t,{routerKind:"App Router",routePath:f,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:A})},!1,T),t}},l=await O.handleResponse({req:e,nextConfig:w,cacheKey:q,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:g,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:S,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:o});if(!k)return null;if((null==l||null==(n=l.value)?void 0:n.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(u=l.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let E=(0,h.fromNodeOutgoingHttpHeaders)(l.value.headers);return o&&k||E.delete(_.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||t.getHeader("Cache-Control")||E.get("Cache-Control")||E.set("Cache-Control",(0,m.getCacheControlHeader)(l.cacheControl)),await (0,p.sendResponse)(K,j,new Response(l.value.body,{headers:E,status:l.value.status||200})),null};B?await u(B):await M.withPropagatedContext(e.headers,()=>M.trace(l.BaseServerSpan.handleRequest,{spanName:`${F} ${f}`,kind:n.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},u))}catch(t){if(t instanceof E.NoFallbackError||await O.onRequestError(e,t,{routerKind:"App Router",routePath:L,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:A})},!1,T),k)throw t;return await (0,p.sendResponse)(K,j,new Response(null,{status:500})),null}}e.s(["handler",()=>S,"patchFetch",()=>A,"routeModule",()=>O,"serverHooks",()=>T,"workAsyncStorage",()=>b,"workUnitAsyncStorage",()=>g],32203)},85685,e=>{e.v(e=>Promise.resolve().then(()=>e(54799)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__c6010f88._.js.map